@using Microsoft.AspNetCore.Identity
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
@{
    var current_user = await UserManager.GetUserAsync(User);
    var current_username = current_user.UserName;
    bool isAdmin = false;
    if (current_username == "lvolta@umich.edu" || current_username == "jvolta@vtechnologies.com")
    {
        isAdmin = true;
    }
}

<div id="Meals">
    <h2>Meals</h2>
    <p class="lead">[Meal Description]</p>
    <hr />

    <p class="my-3">
        <input style="float:left" class="form-control" type="text" data-bind="textInput: SearchString" placeholder="Search for...">
        <button class="btn btn-default" data-bind="click: function () { populateData(); }" style="height:34px; width:100px; padding: 2px 4px;">Go!</button>
        <button class="btn btn-primary" data-bind="click: function () { $root.showEdit() }" style="float:right; height:34px; width:100px; padding: 2px 4px;">Create Meal</button>
    </p>

    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>NickName</th>
                <th>Components</th>
                <th>Calories/Serving (cals)</th>
                <th>Protein/Serving (g)</th>
                <th>Notes</th>
                <th></th>
            </tr>
        </thead>
        <tbody data-bind="foreach: Meals">
                <tr>
                    <td data-bind="text: NickName"></td>
                    <td>
                        <ul data-bind="foreach: MealComponents" style="list-style: none">
                           <li data-bind="FoodItem.Name"></li>
                        </ul>
                    </td>
                    <td  data-bind="text: CaloriesPerServing"></td>
                    <td  data-bind="text: ProteinPerServing"></td>
                    <td  data-bind="text: Notes"></td>
                    <td>
                        @{if (isAdmin)
                            {
                                <a style="color: grey;" data-bind="click: function() { $root.showEdit($data);}">Edit</a>
                                <a style="color: grey;" data-bind="click: function() { $root.showDetails($data); }">View</a>
                                <a style="color: grey;" data-bind="click: function() { $root.deleteConfirm($data); }">Delete</a>
                            }
                            else
                            {
                                <a style="color: grey;" data-bind="visible: !CreatedByAdmin(), click: function() { $root.showEdit($data);}">Edit</a>
                                <a style="color: grey;" data-bind="click: function() { $root.showDetails($data); }" class="">View</a>
                                <a style="color: grey;" data-bind="visible: !CreatedByAdmin(), click: function() { $root.deleteConfirm($data); }" class="">Delete</a>
                            } }

                    </td>
                </tr>
            
        </tbody>
    </table>
    </div>